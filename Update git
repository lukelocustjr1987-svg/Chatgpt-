// --- 1. Triple → logical value ------------------------------------

function tripleValue(triple) {
  const positives = triple.split('').filter(c => c === '/').length;
  return positives >= 2 ? 1 : 0;
}

function valueToTriple(v) {
  return v === 1 ? '///' : '~~~';
}

// --- 2. Pivot encodings -------------------------------------------

const PIVOT = '/16';          // core pivot
const PIVOT_BALANCED = '/<16/>'; // balanced pivot
const PIVOT_UP = '/16 >>';    // upshifted pivot

// --- 3. Arithmetic on {0,1} with pivot-aware division -------------

function addSeg(aTriple, bTriple) {
  const a = tripleValue(aTriple);
  const b = tripleValue(bTriple);
  const v = (a + b >= 1) ? 1 : 0; // saturated
  return valueToTriple(v);
}

function subSeg(aTriple, bTriple) {
  const a = tripleValue(aTriple);
  const b = tripleValue(bTriple);
  const v = (a - b <= 0) ? 0 : 1; // floored
  return valueToTriple(v);
}

function mulSeg(aTriple, bTriple) {
  const a = tripleValue(aTriple);
  const b = tripleValue(bTriple);
  const v = a * b; // AND
  return valueToTriple(v);
}

function divSeg(aTriple, bTriple) {
  const a = tripleValue(aTriple);
  const b = tripleValue(bTriple);

  if (b === 0 && a === 1) return PIVOT_UP;      // 1 ÷ 0
  if (b === 0 && a === 0) return PIVOT_BALANCED; // 0 ÷ 0
  if (b === 1 && a === 0) return valueToTriple(0); // 0 ÷ 1
  if (b === 1 && a === 1) return valueToTriple(1); // 1 ÷ 1
}

// --- 4. Structural wrappers: << >> around < > ---------------------

function wrapBalanced(n) {
  // /<n/> form, HTML-safe if needed
  return `/<${n}/>`;
}

function wrapBiased(n) {
  // << /<n/> >> form
  return `<< ${wrapBalanced(n)} >>`;
}

// --- 5. Fuzzy numbers in Pi Logic --------------------------------

// A and B are membership functions: x -> [0,1]
function divideFuzzy(A, B) {
  return function(x) {
    const Ax = A(x);
    const Bx = B(x);

    if (Bx === 0 && Ax === 1) {
      // 1 ÷ 0 → pivot up
      return { value: 1, symbol: PIVOT_UP };
    }
    if (Bx === 0 && Ax === 0) {
      // 0 ÷ 0 → balanced pivot
      return { value: 0, symbol: PIVOT_BALANCED };
    }
    const y = Ax / Bx;
    return { value: y, symbol: wrapBalanced(y.toFixed(3)) };
  };
}

// --- 6. Example usage ---------------------------------------------

// Simple fuzzy sets
const A = x => Math.max(0, 1 - Math.abs(x));   // triangular peak at 0
const B = x => Math.max(0, 1 - Math.abs(x-1)); // triangular peak at 1

const AdivB = divideFuzzy(A, B);

// Sample
for (let x = -1; x <= 2; x += 0.5) {
  const res = AdivB(x);
  console.log(`x=${x.toFixed(1)}  A/B=${res.value.toFixed(3)}  symbol=${res.symbol}`);
}
